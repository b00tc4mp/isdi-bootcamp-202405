<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register</title>

    <style></style>
  </head>

  <body>
    <h1>Register</h1>

    <form>
      <label for="name">Name</label>
      <input type="text" id="name" name="name" placeholder="Name" />

      <label for="surname">Surname</label>
      <input type="text" id="surname" name="surname" placeholder="Surname" />

      <label for="email">Email</label>
      <input type="text" id="email" name="email" placeholder="Email" />

      <label for="username">Username</label>
      <input type="text" id="username" name="username" placeholder="Username" />

      <label for="password">Password</label>
      <input
        type="password"
        id="password"
        name="password"
        placeholder="Password"
      />

      <label for="password2">Repeat password</label>
      <input
        type="password"
        id="password2"
        name="password2"
        placeholder="Repeat Password"
      />

      <button type="submit">Register</button>
    </form>

    <a href="">Login</a>

    <script>
      var form = document.querySelector("form");

      form.onsubmit = function (event) {
        event.preventDefault();

        var nameInput = document.getElementById("name");
        var surnameInput = document.getElementById("surname");
        var emailInput = document.getElementById("email");
        var usernameInput = document.getElementById("username");
        var passwordInput = document.getElementById("password");
        var passwordRepeatInput = document.getElementById("password2");

        var name = nameInput.value;
        var surname = surnameInput.value;
        var email = emailInput.value;
        var username = usernameInput.value;
        var password = passwordInput.value;
        var passwordRepeat = passwordRepeatInput.value;

        try {
          registerUser(
            name,
            surname,
            email,
            username,
            password,
            passwordRepeat
          );

          alert("user successfully registered");

          location.href = "login.html";
        } catch (error) {
          alert(error.message);
        }
      };
    </script>
    <script>
      var EMAIL_REGEX = /^[a-z0-9._]+@[a-z0-9.-]{3,63}\.[a-z]{2,10}$/;
      var NAME_REGEX = /^(?!.*\s{2})[a-zA-Z ]{3,16}$/;
      var USER_REGEX = /^(?!.*\s{2})[a-zA-Z0-9._-]{4,16}$/;
      var PASSWORD_REGEX = /^(?=.[A-Za-z])(?=.\d)[A-Za-z\d]{8,}$/;

      function registerUser(
        name,
        surname,
        email,
        username,
        password,
        passwordRepeat
      ) {
        if (!NAME_REGEX.test(name.trim())) throw new Error("invalid name");
        if (!NAME_REGEX.test(surname.trim())) throw new Error("ivalid surname");
        if (!EMAIL_REGEX.test(email)) throw new Error("invalid email");
        if (!USER_REGEX.test(username)) throw new Error("invalid username");
        if (!PASSWORD_REGEX.test(password)) throw new Error("invalid password");
        if (password !== passwordRepeat)
          throw new Error("passwords do not match");

        var users =
          localStorage.users !== undefined
            ? JSON.parse(localStorage.users)
            : [];

        var user = users.find(function (user) {
          return user.email === email;
        });

        if (user !== undefined) throw new Error("email already exists");

        var user = users.find(function (user) {
          return user.username === username;
        });

        if (user !== undefined) throw new Error("username already exists");

        user = {
          name: name,
          surname: surname,
          email: email,
          username: username,
          password: password,
        };

        users.push(user);

        localStorage.users = JSON.stringify(users);
      }
    </script>
  </body>
</html>
