#!/bin/zsh

# Remote repository URL on GitHub
remote_repo="https://github.com/trosdesuru/isdi-bootcamp-202405.git"

# Function to check the existence and status of the remote repository
check_remote_repo() {
    echo "Checking if the remote repository exists and is accessible..."
    if git ls-remote "$remote_repo" HEAD &>/dev/null; then
        echo -ne "\033[32mRemote repository found and accessible.\033[0m\n"
        return 0
    else
        echo -ne "\033[31mError: Remote repository not found or empty.\033[0m\n"
        return 1
    fi
}

# Function to update all local branches with the remote version
update_branches() {
    echo "Fetching updates from the remote repository..."
    git fetch origin &>/dev/null  # Fetch all updates from the remote repository

    # List of local branches to synchronize
    local_branches=(
        "develop"
        "feature/playground"
        "feature/ponies"
        "main"
    )

    total_branches=${#local_branches[@]}
    current_branch=0

    # Iterate over all local branches and update them
    for local_branch in "${local_branches[@]}"; do
        echo "Switching to branch '$local_branch'..."
        git checkout $local_branch &>/dev/null

        echo "Pulling latest changes for branch '$local_branch' from remote repository..."
        git pull origin $local_branch &>/dev/null

        current_branch=$((current_branch + 1))
        progress_bar $current_branch $total_branches "Updating branch: $local_branch"
    done

    echo -ne "\033[32mAll local branches have been updated.\033[0m\n"
}

# Function to display a progress bar
progress_bar() {
    local current=$1
    local total=$2
    local message=$3
    local progress=$((current * 100 / total))
    local completed=$((progress / 2))
    local remaining=$((50 - completed))

    printf -v bar "%${completed}s" ""
    bar=${bar// /#}
    printf -v spaces "%${remaining}s" ""
    echo -ne "\r[${bar}${spaces}] ${progress}%% - ${message}"
}

# Execute the synchronization process
clear
echo "Starting synchronization process..."
if check_remote_repo; then
    echo "Updating local branches..."
    update_branches
else
    echo -ne "\033[31mFailed to synchronize due to issues with the remote repository.\033[0m\n"
fi

